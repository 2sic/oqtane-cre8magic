@namespace ToSic.Cre8magic.TestTheme.Client
@using Microsoft.AspNetCore.Http
@using ToSic.Cre8magic.Components.Internal
@using ToSic.Cre8magic.PageContexts
@using ToSic.Cre8magic.OqtaneBs5
@inherits MyThemeBase
@inject IJSRuntime JsRuntime
@inject IHttpContextAccessor HttpContextAccessor
@*
File Purpose:       Core theme file and Default variation
Recommendations:    -
Nice to know:
    - Inherits from ThemeBase, which has some additional logic to make things happen
    - The other theme files inherit from this, and will also use the HTML here
*@
@code
{
    public override string Name => "Default";
    public override string Layout => "default";
    protected override string MagicContextClasses => "floatwideheader";

    [Parameter, SupplyParameterFromQuery]
    public string TestSettings { get; set; }
    
    public Dictionary<string, string> TestSettingsDic = new()
    {
        { "default", "default (json)" }, // leave test as is, using base settings
        { "none", "no settings" }, // use no settings at all - as if nothing were configured.
        { "catalog", "use custom catalog" }, // use full custom catalog
    };
    
    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        var cookie = HttpContextAccessor.HttpContext.Request.Cookies["TestSettings"];
        switch (cookie)
        {
            case "default":
                // MagicHat.UseSettings(ThemePackageSettings, Layout);
                // MagicHat.UseSettingsCatalog(null);
                break;
            case "none":
                // MagicHat.UseSettings(null, Layout);
                break;
            case "catalog":
                MagicHat.UseSettingsCatalog(ThemeSettingsForTests.Catalog1);
                break;
        }
    }

    protected Task SetSettingsCookie(string name)
    {
        var interop = new Interop(JsRuntime);
        return interop.SetCookie("TestSettings", name, 1);
    }
    /// <summary>
    /// The ThemePackageSettings must be set in this class, so the Settings initializer can pick it up.
    ///
    /// For testing we have a special setup where we provide null to ensure nothing is configured if certain test cookies are set.
    /// </summary>
    public override MagicThemePackage ThemePackage
    {
        get
        {
            var cookie = HttpContextAccessor.HttpContext.Request.Cookies["TestSettings"];
            return string.IsNullOrWhiteSpace(cookie) || cookie == "default"
                ? base.ThemePackage
                : null;
        }
    }

}
@*
    The MagicPageContext wrapper does this:
    1. It ensures that certain classes are added to the body or wrapper-div so that styles can be optimized by page, language, branch etc.
       Note that the specifics are configured in the configuration
*@
<MagicPageContext Settings="new() { Classes = MagicContextClasses }">

    @* Show any errors to the admin if something went wrong like when loading settings *@
    <MagicExceptions></MagicExceptions>

    @* Header with logo and navigation etc. *@
    <Header ThemeKit="ThemeKit"></Header>

    @* Switch Test Data *@
    <ul class="navbar-nav" style="flex-direction: row;">
        @foreach (var pair in TestSettingsDic)
        {
            var isActive = TestSettings == pair.Key;
            
            <li class="nav-item">
                <button class='navbar-link @(isActive ? "active" : "")' @onclick="() => SetSettingsCookie(pair.Key)" title="@pair.Value">@pair.Key</button>
                &nbsp;
            </li>
        }
    </ul>


    @* Header Pane *@
    <div id="@ThemeKit.Designer.Id("sectionHeader")" class='@ThemeKit.Designer.Classes("sectionHeader") @ThemeKit.Designer.PaneClasses("Header")'>
        <Pane Name="Header"/>
    </div>

    @* Main Section *@
    <main id="@ThemeKit.Designer.Id("sectionMain")" class="@ThemeKit.Designer.Classes("sectionMain")">

        @* Show Breadcrumb if desired *@
        @if (ThemeKit.ShowPart("breadcrumbs"))
        {
            <Breadcrumbs></Breadcrumbs>
        }

        @* If we show the Sidebar, then it must be side-by-side with the Content *@
        @if (ThemeKit.ShowPart("menuSidebar"))
        {
            <div class="container">
                <div class="row">
                    <div class='@ThemeKit.Designer.Classes("sidebarBody")'>
                        <Pane Name="@PaneNames.Default"/>
                        <MagicShowComponents Components="@MagicComponents"></MagicShowComponents>
                    </div>
                    <div class='@ThemeKit.Designer.Classes("sidebarMenu")'>
                        <div id="@ThemeKit.Designer.Id("sidebarMenu-inner")" class="@ThemeKit.Designer.Classes("sidebarMenu-inner")">
                            <MagicMenu Settings="new() { PartName = ThemeInfo.MenuSidebar }"></MagicMenu>
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <Pane Name="@PaneNames.Default"/>
            <MagicShowComponents Components="@MagicComponents"></MagicShowComponents>
        }

        <ToTop></ToTop>
    </main>
    <Footer></Footer>
</MagicPageContext>