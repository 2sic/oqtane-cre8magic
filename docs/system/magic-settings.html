<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>cre8magic – Magic Settings | cre8magic </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="cre8magic – Magic Settings | cre8magic ">
      
      <link rel="icon" href="../assets/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/2sic/oqtane-cre8magic/blob/feature/v5/docs-src/pages/system/magic-settings.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../assets/cre8magic-logo50.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="cre8magic--magic-settings">cre8magic – Magic Settings</h1>

<p><strong>Magic Settings</strong> allow you to move 95% of the theme code into some kind of configuration.</p>
<h2 id="overview">Overview</h2>
<p>Basically the magic settings let you put a bunch of parameters in a JSON file.
This file is then used by your Theme and it's Controls to</p>
<ul>
<li>determine what Blazor files to use (like what Template should be used for the menu)</li>
<li>what to do with <code>class=&quot;...&quot;</code> or <code>id=&quot;...&quot;</code> in the HTML</li>
<li>and much more 😉</li>
</ul>
<blockquote>
<p>This basic principle allows you to create and tweak amazing designs
without ever recompiling the Theme.</p>
<p>It also allows you to create variations of your theme with the same Blazor files.</p>
</blockquote>
<h2 id="example-json">Example JSON</h2>
<p>See <a href="theme-json.html">settings-json</a> to see an example file.</p>
<h2 id="the-configuration-file">The Configuration File</h2>
<p>The system works by creating a json file such as <code>theme-settings.json</code>.</p>
<p>This is placed in your themes <code>wwwroot</code> folder like this:</p>
<p><code>wwwroot/ToSic.Themes.BlazorCms/theme-settings.json</code></p>
<p><em>Note that we don't use <code>...Client</code> in the path, just the real namespace.</em></p>
<p>Which file to use can be configured in the theme.
Normally you would use the same file for all variations of your theme, but the important thing is that the theme
must give some initial configuration object to the cre8magic Services.</p>
<p>Here's how:</p>
<h3 id="create-the-magicpackagesettings">Create the MagicPackageSettings</h3>
<p>This could be done anywhere, but I would place the code in the <code>ThemeInfo.cs</code> file:</p>
<pre><code class="lang-c#">    /// &lt;summary&gt;
    /// Default settings used in this package.
    /// They are defined here and given as initial values to the ThemeSettingsService in the Default Razor file.
    /// &lt;/summary&gt;
    public static MagicPackageSettings ThemePackageDefaults = new()
    {
        // The package name is important, as it's used to find assets etc.
        PackageName = new ThemeInfo().Theme.PackageName,

        // The json file in the theme folder folder containing all kinds of settings etc.
        SettingsJsonFile = &quot;theme-settings.json&quot;,
    };
</code></pre>
<h3 id="tell-the-theme-to-use-these-settings">Tell the Theme to Use these Settings</h3>
<p>Then in the theme, you should inherit from the <code>MagicTheme</code> base class and set the ThemePackageSettings like this:</p>
<pre><code class="lang-c#">public override MagicPackageSettings ThemePackageSettings =&gt; ThemeInfo.ThemePackageDefaults;
</code></pre>
<p>This would usually look a bit like this:</p>
<pre><code class="lang-c#">public abstract class MyThemeBase : MagicTheme
{
    public override List&lt;Resource&gt; Resources =&gt; new()
    {
        new() { ResourceType = Stylesheet, Url = $&quot;{ThemePath()}theme.min.css&quot; },       // Bootstrap generated with Sass/Webpack
        new() { ResourceType = Script, Url = $&quot;{ThemePath()}bootstrap.bundle.min.js&quot; }, // Bootstrap JS
        new() { ResourceType = Script, Url = $&quot;{ThemePath()}ambient.js&quot;, },             // Ambient JS for page Up-button etc.
    };

    /// &lt;summary&gt;
    /// The ThemePackageSettings must be set in this class, so the Settings initializer can pick it up.
    /// &lt;/summary&gt;
    public override MagicPackageSettings ThemePackageSettings =&gt; ThemeInfo.ThemePackageDefaults;

    public override string Panes =&gt; string.Join(&quot;,&quot;, PaneNames.Default, PaneNameHeader);
}
</code></pre>
<p>that's it ✌🏽</p>
<h2 id="how-the-settings-work">How the Settings Work</h2>
<p>Internally the <code>MagicSettingsService</code> will be initialized automatically by the <code>MagicTheme</code> base class.
It will then go and pick up the JSON file, parse it, do a bunch of magic and come back with a final <code>MagicSettings</code> object.
This <code>MagicSettings</code> will then contain all the important settings for the current page/theme.
It will also keep a reference to other settings such as <code>Menus</code> for which many configurations can exist.</p>
<h2 id="how-the-settings-are-broadcast">How the Settings are Broadcast</h2>
<p>A key feature of this system is that the settings are initially loaded in the theme,
and then broadcast to all controls used in that theme.</p>
<p>To make this happen, the theme must wrap everything in a <code>MagicContextAndSettings</code> tag:</p>
<pre><code class="lang-razor">&lt;MagicContextAndSettings Settings=&quot;Settings&quot;&gt;
  Content
&lt;/MagicContextAndSettings&gt;
</code></pre>
<p>This will do a few things</p>
<ol>
<li>Make sure that the inner content is only shown if Settings are loaded - otherwise show a <code>loading settings...</code> text</li>
<li>Broadcast the <code>MagicSettings</code> with the name <code>Settings</code> to all child controls using <code>CascadingValue</code>.</li>
<li>It will also ensure that the <a href="magic-context.html">MagicContext</a> is set on the page</li>
</ol>
<p>TODO:</p>
<ol>
<li>EXPLAIN SETTINGS MORE</li>
</ol>
<h2 id="continue">Continue...</h2>
<p>Then continue back to the 👉🏾 <a href="../index.html">Home</a></p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/2sic/oqtane-cre8magic/blob/feature/v5/docs-src/pages/system/magic-settings.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
